-- USER SQL
CREATE USER FITZ IDENTIFIED BY "FITZ123"  
DEFAULT TABLESPACE "SYSTEM"
TEMPORARY TABLESPACE "TEMP";

-- QUOTAS

-- ROLES
GRANT "DBA" TO FITZ WITH ADMIN OPTION;

-- SYSTEM PRIVILEGES

------------------------------------------------- CREATE NATIONALITIES TABLE ----------------------------------

CREATE TABLE FITZ.NATIONALITIES 
(
  NATIONALITY_ID NUMBER NOT NULL 
, NAME VARCHAR2(20) NOT NULL
, COUNTRY VARCHAR2(20) NOT NULL
, CONSTRAINT NATIONALITIES_PK PRIMARY KEY 
  (
    NATIONALITY_ID 
  )
  ENABLE 
);

Insert into FITZ.NATIONALITIES (NATIONALITY_ID,NATIONALITY,COUNTRY) values (1,'IRISH','IRELAND');
Insert into FITZ.NATIONALITIES (NATIONALITY_ID,NATIONALITY,COUNTRY) values (2,'SPANISH','SPAIN');
Insert into FITZ.NATIONALITIES (NATIONALITY_ID,NATIONALITY,COUNTRY) values (3,'POLISH','POLAND');
Insert into FITZ.NATIONALITIES (NATIONALITY_ID,NATIONALITY,COUNTRY) values (4,'ENGLISH','ENGLAND');
Insert into FITZ.NATIONALITIES (NATIONALITY_ID,NATIONALITY,COUNTRY) values (5,'AMERICAN','UNITED STATES');

------------------------------------------------- CREATE DEPARTMENTS TABLE ----------------------------------

CREATE TABLE FITZ.DEPARTMENTS 
(
  DEPARTMENT_ID NUMBER NOT NULL 
, NAME VARCHAR2(20) NOT NULL
, CONSTRAINT DEPARTMENTS_PK PRIMARY KEY 
  (
    DEPARTMENT_ID 
  )
  ENABLE 
);

Insert into FITZ.DEPARTMENTS (DEPARTMENT_ID,DEPARTMENT_NAME) values (1,'Concierge');
Insert into FITZ.DEPARTMENTS (DEPARTMENT_ID,DEPARTMENT_NAME) values (2,'Reception');
Insert into FITZ.DEPARTMENTS (DEPARTMENT_ID,DEPARTMENT_NAME) values (3,'Accomodation');
Insert into FITZ.DEPARTMENTS (DEPARTMENT_ID,DEPARTMENT_NAME) values (4,'Accounts');
Insert into FITZ.DEPARTMENTS (DEPARTMENT_ID,DEPARTMENT_NAME) values (5,'Bar');
Insert into FITZ.DEPARTMENTS (DEPARTMENT_ID,DEPARTMENT_NAME) values (6,'HR');
Insert into FITZ.DEPARTMENTS (DEPARTMENT_ID,DEPARTMENT_NAME) values (7,'Reception manager');
Insert into FITZ.DEPARTMENTS (DEPARTMENT_ID,DEPARTMENT_NAME) values (8,'Hotel Manager');
Insert into FITZ.DEPARTMENTS (DEPARTMENT_ID,DEPARTMENT_NAME) values (9,'Reserwations');
Insert into FITZ.DEPARTMENTS (DEPARTMENT_ID,DEPARTMENT_NAME) values (10,'Hostess');

-------------------------------------------------CREATE HOTELS TABLE---------------------------------------------------


	
CREATE TABLE FITZ.HOTELS 
(
  HOTEL_ID NUMBER NOT NULL 
, COUNTRY_ID NUMBER NOT NULL 
, NAME VARCHAR2(30) NOT NULL 
, CONSTRAINT HOTELS_PK PRIMARY KEY 
  (
    HOTEL_ID 
  )
  ENABLE 
);

ALTER TABLE FITZ.HOTELS
ADD CONSTRAINT HOTELS_TO_COUNTRIES_FK FOREIGN KEY
(
  COUNTRY_ID
)
REFERENCES FITZ.NATIONALITIES
(
  NATIONALITY_ID 
)
ENABLE;

CREATE SEQUENCE FITZ.HOTELS_SEQ START WITH 1 INCREMENT BY 1;

CREATE OR REPLACE TRIGGER FITZ.HOTELS_TRG  
BEFORE INSERT ON FITZ.HOTELS 
FOR EACH ROW 
BEGIN 
    SELECT FITZ.HOTELS_SEQ.NEXTVAL
    INTO new.HOTEL_id 
    FROM dual
END;


insert into FITZ.HOTELS (HOTEL_NAME,HOTEL_ID,COUNTRY_ID) values ('WESTBURY',1,1);
insert into FITZ.HOTELS (HOTEL_NAME,HOTEL_ID,COUNTRY_ID) values ('RIVERLEE',1,1);
insert into FITZ.HOTELS (HOTEL_NAME,HOTEL_ID,COUNTRY_ID) values ('MARDIDROYAL',2,2);
insert into FITZ.HOTELS (HOTEL_NAME,HOTEL_ID,COUNTRY_ID) values ('KEMPINSKI',3,3);
insert into FITZ.HOTELS (HOTEL_NAME,HOTEL_ID,COUNTRY_ID) values ('KENSINGTON',4,4);
insert into FITZ.HOTELS (HOTEL_NAME,HOTEL_ID,COUNTRY_ID) values ('WYATT',5,5);


------------------------------------------------CREATE EMPLOYEES TABLE---------------------------------------------------

CREATE TABLE FITZ.EMPLOYEES 
(
  EMPLOYEE_ID NUMBER NOT NULL 
, FIRST_NAME VARCHAR2(30) NOT NULL 
, LAST_NAME VARCHAR2(30) NOT NULL 
, NATIONALITY_ID NUMBER NOT NULL 
, DEPARTMENT_ID NUMBER NOT NULL 
, SALARY NUMBER(8, 2) DEFAULT 0 NOT NULL 
, HOTEL_ID NUMBER NOT NULL 
, CONSTRAINT EMPLOYEES_PK PRIMARY KEY 
  (
    EMPLOYEE_ID 
  )
  ENABLE 
);

ALTER TABLE FITZ.EMPLOYEES
ADD CONSTRAINT EMPLOYEES_TO_DEPARTMENTS_FK FOREIGN KEY
(
  DEPARTMENT_ID 
)
REFERENCES FITZ.DEPARTMENTS
(
  DEPARTMENT_ID 
)
ENABLE;

ALTER TABLE FITZ.EMPLOYEES
ADD CONSTRAINT EMPLOYEES_TO_NATIONALITIES_FK FOREIGN KEY
(
  NATIONALITY_ID 
)
REFERENCES FITZ.NATIONALITIES
(
  NATIONALITY_ID 
)
ENABLE;


ALTER TABLE FITZ.EMPLOYEES
ADD CONSTRAINT EMPLOYEES_TO_HOTELS_FK FOREIGN KEY
(
  HOTEL_ID 
)
REFERENCES FITZ.HOTELS
(
  HOTEL_ID 
)
ENABLE;



CREATE SEQUENCE FITZ.EMPLOYEES_SEQ START WITH 1 INCREMENT BY 1;

CREATE TRIGGER FITZ.EMPLOYEES_TRG 
BEFORE INSERT ON FITZ.EMPLOYEES 
FOR EACH ROW 
	WHEN (new.employee_id IS NULL)
    BEGIN 
        SELECT FITZ.EMPLOYEES_SEQ.NEXTVAL
        INTO :new.employee_id 
        FROM dual
    END;


Insert into FITZ.EMPLOYEES (FIRST_NAME,LAST_NAME,NATIONALITY_ID,DEPARTMENT_ID,SALARY,HOTEL_ID) 
	values ('Thomas','Connor',1,1,20800.00,1);
Insert into FITZ.EMPLOYEES (FIRST_NAME,LAST_NAME,NATIONALITY_ID,DEPARTMENT_ID,SALARY,HOTEL_ID)
	values ('Maggie','Byrne',1,2,22000.00,1);
Insert into FITZ.EMPLOYEES (FIRST_NAME,LAST_NAME,NATIONALITY_ID,DEPARTMENT_ID,SALARY,HOTEL_ID) 
	values ('Jenniferer','Dwyer',1,3,18000.00,1);
Insert into FITZ.EMPLOYEES (FIRST_NAME,LAST_NAME,NATIONALITY_ID,DEPARTMENT_ID,SALARY,HOTEL_ID)
	values ('Sharon','Burke',1,4,22000.00,1);
	
Insert into FITZ.EMPLOYEES (FIRST_NAME,LAST_NAME,NATIONALITY_ID,DEPARTMENT_ID,SALARY,HOTEL_ID)
	values ('Robert','Foley',1,5,27000.00,2);
Insert into FITZ.EMPLOYEES (FIRST_NAME,LAST_NAME,NATIONALITY_ID,DEPARTMENT_ID,SALARY,HOTEL_ID) 
	values ('Michael','Higgins',1,2,18000.00,2);
Insert into FITZ.EMPLOYEES (FIRST_NAME,LAST_NAME,NATIONALITY_ID,DEPARTMENT_ID,SALARY,HOTEL_ID)
	values ('Eddie','Fitzpatrick',1,1,20800.00,2)	
Insert into FITZ.EMPLOYEES (FIRST_NAME,LAST_NAME,NATIONALITY_ID,DEPARTMENT_ID,SALARY,HOTEL_ID)
	values ('John','Donoghue',1,6,40000.00,2)	
	
	
	
Insert into FITZ.EMPLOYEES (FIRST_NAME,LAST_NAME,NATIONALITY_ID,DEPARTMENT_ID,SALARY,HOTEL_ID)
	values ('Francesco','Gonzalez',2,2,20000.00,3);
Insert into FITZ.EMPLOYEES (FIRST_NAME,LAST_NAME,NATIONALITY_ID,DEPARTMENT_ID,SALARY,HOTEL_ID) 
	values ('Antonio','Rodriguez',2,3,16000.00,3);
Insert into FITZ.EMPLOYEES (FIRST_NAME,LAST_NAME,NATIONALITY_ID,DEPARTMENT_ID,SALARY,HOTEL_ID)
	values ('Paula','Lopez',2,5,21000.00,3);	
Insert into FITZ.EMPLOYEES (FIRST_NAME,LAST_NAME,NATIONALITY_ID,DEPARTMENT_ID,SALARY,HOTEL_ID)
	values ('Sara','Fernandez',2,7,28000.00,3);	

	
	
Insert into FITZ.EMPLOYEES (FIRST_NAME,LAST_NAME,NATIONALITY_ID,DEPARTMENT_ID,SALARY,HOTEL_ID)
	values ('Mateusz','Morawiecki',3,8,60000.00,4);
Insert into FITZ.EMPLOYEES (FIRST_NAME,LAST_NAME,NATIONALITY_ID,DEPARTMENT_ID,SALARY,HOTEL_ID) 
	values ('Beata','Szydlo',3,9,20000.00,4);
Insert into FITZ.EMPLOYEES (FIRST_NAME,LAST_NAME,NATIONALITY_ID,DEPARTMENT_ID,SALARY,HOTEL_ID)
	values ('Kamila','Pichowicz',3,3,15000.00,4);	
Insert into FITZ.EMPLOYEES (FIRST_NAME,LAST_NAME,NATIONALITY_ID,DEPARTMENT_ID,SALARY,HOTEL_ID)
	values ('Jaroslaw','Kaczynski',3,6,25000.00,4);

	

Insert into FITZ.EMPLOYEES (FIRST_NAME,LAST_NAME,NATIONALITY_ID,DEPARTMENT_ID,SALARY,HOTEL_ID)
	values ('Teresa','May',4,10,18000.00,5);
Insert into FITZ.EMPLOYEES (FIRST_NAME,LAST_NAME,NATIONALITY_ID,DEPARTMENT_ID,SALARY,HOTEL_ID) 
	values ('Boris','Johnson',4,2,24000.00,5);
Insert into FITZ.EMPLOYEES (FIRST_NAME,LAST_NAME,NATIONALITY_ID,DEPARTMENT_ID,SALARY,HOTEL_ID)
	values ('Gordon','Brown',4,5,19000.00,5);	
Insert into FITZ.EMPLOYEES (FIRST_NAME,LAST_NAME,NATIONALITY_ID,DEPARTMENT_ID,SALARY,HOTEL_ID)
	values ('David','Cameron',4,6,45000.00,5);	


Insert into FITZ.EMPLOYEES (FIRST_NAME,LAST_NAME,NATIONALITY_ID,DEPARTMENT_ID,SALARY,HOTEL_ID)
	values ('Donald','Trump',5,8,70000.00,6);
Insert into FITZ.EMPLOYEES (FIRST_NAME,LAST_NAME,NATIONALITY_ID,DEPARTMENT_ID,SALARY,HOTEL_ID) 
	values ('Stephen','Colbert',5,1,18000.00,6);
Insert into FITZ.EMPLOYEES (FIRST_NAME,LAST_NAME,NATIONALITY_ID,DEPARTMENT_ID,SALARY,HOTEL_ID)
	values ('John','Steward',5,5,22000.00,6);	
Insert into FITZ.EMPLOYEES (FIRST_NAME,LAST_NAME,NATIONALITY_ID,DEPARTMENT_ID,SALARY,HOTEL_ID)
	values ('Hilary','Clinton',5,3,17000.00,6);	

-----------------------------------------------------------EMPLOYEES VIEW EXAMPLE----------------------------------------	

CREATE VIEW FITZ.EMPLOYEES_VIEW
AS SELECT DISTINCT employees.employee_id,employees.first_name,employees.last_name,nationalit AS NATIONALITY,departments.first_name AS DEPARTMENT,employees.salary
    FROM fitz.employees 
    JOIN fitz.nationalities 
        ON fitz.employees.nationality_id=fitz.nationalities.NATIONALITY_ID 
    JOIN fitz.departments
        ON fitz.employees.department_id=fitz.departments.department_id;

-------------------FUNCTIONS--------------------	
    
CREATE OR REPLACE FUNCTION   count_employees(deptid employees.department_id%TYPE)
RETURN NUMBER 
IS
emp_count NUMBER(6);
BEGIN
  SELECT COUNT (employee_id) INTO emp_count
  FROM FITZ.EMPLOYEES
  WHERE department_id = deptid;

  RETURN emp_count;
END;	


-------------------PROCEDURES--------------

CREATE OR REPLACE PROCEDURE    ADD_DEPARTMENT 
    
    (v_DEPARTMENT_id FITZ.DEPARTMENTS.DEPARTMENT_id%TYPE,
    v_DEPARTMENT_NAME FITZ.DEPARTMENTS.DEPARTMENT_NAME%TYPE)
IS
BEGIN
    INSERT INTO FITZ.DEPARTMENTS(DEPARTMENT_ID,"NAME")
    VALUES(v_DEPARTMENT_id,v_DEPARTMENT_NAME);
END;

-----------------CASE STATEMENT -------
SELECT salary_group, count(*) FROM
    (SELECT
        EMPLOYEE_id,
        SURNAME,
        CASE
              WHEN salary <= 19000 THEN 'low'
              WHEN salary > 19000 AND salary <= 35000 THEN 'medium'
              WHEN salary > 40000 THEN 'high'
              ELSE 'Theres a problem'
        END AS salary_group
      FROM FITZ.EMPLOYEES) x
GROUP BY salary_group;

